<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Score card generation • harp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Score card generation">
<meta property="og:description" content="harp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">harp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9034</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/scorecards.html">Score card generation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/harphub/harp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Score card generation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/harphub/harp/blob/HEAD/vignettes/scorecards.Rmd" class="external-link"><code>vignettes/scorecards.Rmd</code></a></small>
      <div class="hidden name"><code>scorecards.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="what-is-a-score-card">What is a score card?<a class="anchor" aria-label="anchor" href="#what-is-a-score-card"></a>
</h2>
<p>Score cards provide a quick overview of the performance of one forecast model compared with another. It shows which model has better performance for a range of scores and statistical significance of those differences. The statistical significance is computed by pooling the data by, for example, forecast date, and computing the score for each pool and then sampling from those pools, with replacement, to compute a mean score. This process is repeated <em>n</em> times using a <em>bootstrap</em> method, and the difference between the forecast models for each mean score is calculated for each of the <em>n</em> bootstrap replicates. The proportion of the scores that are better for one model than another gives the confidence of the difference. The example below shows a score card comparing many parameters for a range of scores for two forecast models, named “Model A” and “Model B”.</p>
<p><img src="../reference/figures/example_scorecard.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="score-card-generation">Score card generation<a class="anchor" aria-label="anchor" href="#score-card-generation"></a>
</h2>
<p>The process for generating a score card involves several steps:</p>
<ul>
<li>Reading the forecast data</li>
<li>Selecting the common cases for all forecast model</li>
<li>Reading the observation data</li>
<li>Joining the observation data to the forecast data</li>
<li>Bootstrapping the verification</li>
</ul>
<p>These steps are repeated for each parameter and then the results can be joined together into a single object and the score card plotted.</p>
<p>We will first go over how to compute the data for a single parameter, in this case 2m temperature, which in harp is “T2m”. We will use data from the MEPS_prod and AROME_Arctic_prod deterministic models that are in the harpData package. Since these data only include one forecast, we will pool the scores by observation station.</p>
<p>If you don’t already have the harpData package install it with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"harphub/harpData"</span><span class="op">)</span></code></pre></div>
<p>Note that harpData contains close to 1GB of data so may take some time to download.</p>
<p>Now we can begin the score card generation…</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/harphub/harp" class="external-link">harp</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: harpIO</span>
<span class="co">#&gt; Loading required package: harpPoint</span>
<span class="co">#&gt; Loading required package: harpVis</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="co">#&gt; Loading required package: shiny</span>
<span class="co">#&gt; Loading required package: harpSpatial</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">param</span> <span class="op">&lt;-</span> <span class="st">"T2m"</span>

<span class="co"># Read the forecast data</span>
<span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpIO/man/read_point_forecast.html" class="external-link">read_point_forecast</a></span><span class="op">(</span>
  start_date <span class="op">=</span> <span class="fl">2019021700</span>,
  end_date   <span class="op">=</span> <span class="fl">2019021718</span>,
  fcst_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AROME_Arctic_prod"</span>, <span class="st">"MEPS_prod"</span><span class="op">)</span>,
  fcst_type  <span class="op">=</span> <span class="st">"det"</span>,
  parameter  <span class="op">=</span> <span class="va">param</span>,
  by         <span class="op">=</span> <span class="st">"6h"</span>,
  file_path  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"FCTABLE/deterministic"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Select the common cases</span>
<span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/common_cases.html" class="external-link">common_cases</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span>

<span class="co"># Pull the station IDs from fcst so we don't read too many observations</span>
<span class="va">stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/pull_stations.html" class="external-link">pull_stations</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span>

<span class="co"># Read the observations</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpIO/man/read_point_obs.html" class="external-link">read_point_obs</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/first_validdate.html" class="external-link">first_validdate</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/last_validdate.html" class="external-link">last_validdate</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span>,
  <span class="va">param</span>, 
  obs_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"OBSTABLE"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,
  stations <span class="op">=</span> <span class="va">stations</span>
<span class="op">)</span>

<span class="co"># Join the observations to the forecast</span>
<span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/join_to_fcst.html" class="external-link">join_to_fcst</a></span><span class="op">(</span><span class="va">fcst</span>, <span class="va">obs</span><span class="op">)</span>

<span class="co"># Bootstrap the score. Since we use the parameter argument to select the </span>
<span class="co"># parameter column in the data, we need to tell the function to use the </span>
<span class="co"># param variable as a column name rather than a variable. We do this by</span>
<span class="co"># wrapping in double curly brackets.</span>

<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/pooled_bootstrap_score.html" class="external-link">pooled_bootstrap_score</a></span><span class="op">(</span>
  <span class="va">fcst</span>, 
  <span class="va">det_verify</span>,         <span class="co"># the function we want to use in the verification</span>
  <span class="op">{</span><span class="op">{</span><span class="va">param</span><span class="op">}</span><span class="op">}</span>,
  n         <span class="op">=</span> <span class="fl">100</span>,     <span class="co"># the number of bootstrap replicates</span>
  pooled_by <span class="op">=</span> <span class="st">"SID"</span>
<span class="op">)</span>

<span class="va">result</span></code></pre></div>
<pre><code><span class="co">#&gt; <span style="color: #5F5F87;">◌</span> <span style="color: #5F5F87;">confidence_limits</span></span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 34 × 18</span></span>
<span class="co">#&gt;    mname     leadtime num_cases_lower bias_lower rmse_lower mae_lower stde_lower</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AROME_Ar…        0            3.58   0.043<span style="text-decoration: underline;">9</span>        0.740     0.592      <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> AROME_Ar…        3            3.86   0.000<span style="text-decoration: underline;">683</span>      1.53      1.26        1.40</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AROME_Ar…        6            3.54   0.155         1.64      1.35       <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> AROME_Ar…        9            3.87   0.168         1.76      1.46        1.42</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> AROME_Ar…       12            3.56   0.237         1.81      1.51       <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> AROME_Ar…       15            3.84   0.332         1.82      1.52        1.47</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AROME_Ar…       18            3.56   0.358         1.86      1.56       <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> AROME_Ar…       21            3.83   0.160         1.80      1.46        1.52</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> AROME_Ar…       24            3.51   0.143         1.76      1.43       <span style="color: #BB0000;">NA</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AROME_Ar…       27            3.85   0.153         1.56      1.28        1.22</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 24 more rows, and 11 more variables: num_cases_upper &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   bias_upper &lt;dbl&gt;, rmse_upper &lt;dbl&gt;, mae_upper &lt;dbl&gt;, stde_upper &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   num_cases &lt;int&gt;, bias &lt;dbl&gt;, rmse &lt;dbl&gt;, mae &lt;dbl&gt;, stde &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   parameter &lt;chr&gt;</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #5F5F87;">◌</span> <span style="color: #5F5F87;">confidence_of_differences</span></span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 152 × 12</span></span>
<span class="co">#&gt;    fcst_model     leadtime score  ref_model pc_diff symbol     y   value    diff</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AROME_Arctic_…        0 bias   MEPS_prod    0.85 .          1   0.125  0.021<span style="text-decoration: underline;">0</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> AROME_Arctic_…        0 mae    MEPS_prod   -<span style="color: #BB0000;">1</span>    -          1   0.654 -<span style="color: #BB0000;">0.321</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AROME_Arctic_…        0 num_c… MEPS_prod    0    .          1 627      0     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> AROME_Arctic_…        0 rmse   MEPS_prod   -<span style="color: #BB0000;">1</span>    -          1   1.02  -<span style="color: #BB0000;">0.396</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> AROME_Arctic_…        3 bias   MEPS_prod   -<span style="color: #BB0000;">1</span>    -          1   0.249 -<span style="color: #BB0000;">0.098</span><span style="color: #BB0000; text-decoration: underline;">1</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> AROME_Arctic_…        3 mae    MEPS_prod    1    +          1   1.35   0.090<span style="text-decoration: underline;">7</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AROME_Arctic_…        3 num_c… MEPS_prod    0    .          1 678      0     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> AROME_Arctic_…        3 rmse   MEPS_prod    1    +          1   2.03   0.138 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> AROME_Arctic_…        3 stde   MEPS_prod   -<span style="color: #BB0000;">0.9</span>  .          1   2.02   0.155 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AROME_Arctic_…        6 bias   MEPS_prod   -<span style="color: #BB0000;">0.87</span> .          1   0.344 -<span style="color: #BB0000;">0.041</span><span style="color: #BB0000; text-decoration: underline;">1</span></span>
<span class="co">#&gt; <span style="color: #949494;"># … with 142 more rows, and 3 more variables: ref_value &lt;dbl&gt;, better &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   parameter &lt;chr&gt;</span></span></code></pre>
<p>The score card will eventually be plotted from information in the “confidence of differences” data frame in the result. You don’t really need to be familiar with the content of the data frame, except to note that ‘fcst_model’ and ‘ref_model’ are column names and we will want to choose values from those columns when we come to plot the data.</p>
<div class="section level3">
<h3 id="multiple-parameters">Multiple parameters<a class="anchor" aria-label="anchor" href="#multiple-parameters"></a>
</h3>
<p>Now that we have computed the data for one parameter, how should we do it for multiple parameters? We could write a for loop around the above code, but that isn’t all that flexible. It would be preferable to turn the above into a function so that we can reuse it and use R’s <code>lapply</code> function to apply our new function to multiple parameters. Let’s start with making a function, being sure to not hard code anything - we will need arguments for the start and end dates (<code>start_date</code> and <code>end_date</code>), the frequency of the forecasts (<code>by</code>), the names of the forecast models (<code>fcst_model</code>), the forecast type (whether they are ensemble forecasts or deterministic: <code>fcst_type</code>), the paths to the forecasts and observations (<code>fcst_path</code> and <code>obs_path</code>), the number of bootstrap replicates to do (<code>n</code>), what to pool the scores by (<code>pooled_by</code>), and of course the parameter (<code>param</code>). Since we have such a small amount of data in this example we need to set the minimum number of cases to something small (<code>min_cases</code>) to ensure that the function runs. We will also add a groupings argument, with the default value “leadtime”, which we will use in a later example.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scorecard_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span>
  <span class="va">param</span>,
  <span class="va">start_date</span>,
  <span class="va">end_date</span>,
  <span class="va">by</span>,
  <span class="va">fcst_model</span>,
  <span class="va">fcst_type</span>, 
  <span class="va">fcst_path</span>,
  <span class="va">obs_path</span>, 
  <span class="va">n</span>, 
  <span class="va">pooled_by</span>,
  <span class="va">min_cases</span>,
  <span class="va">groupings</span> <span class="op">=</span> <span class="st">"leadtime"</span>
<span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># Output some information to the user</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Generating scorecard data for "</span>, <span class="va">param</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"=============================="</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"="</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span>  
  
  <span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpIO/man/read_point_forecast.html" class="external-link">read_point_forecast</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="va">start_date</span>,
    end_date   <span class="op">=</span> <span class="va">end_date</span>,
    fcst_model <span class="op">=</span> <span class="va">fcst_model</span>,
    fcst_type  <span class="op">=</span> <span class="va">fcst_type</span>,
    parameter  <span class="op">=</span> <span class="va">param</span>,
    by         <span class="op">=</span> <span class="va">by</span>,
    file_path  <span class="op">=</span> <span class="va">fcst_path</span>
  <span class="op">)</span>
  
  <span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/common_cases.html" class="external-link">common_cases</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span>
  
  <span class="va">stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/pull_stations.html" class="external-link">pull_stations</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span>
  
  <span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpIO/man/read_point_obs.html" class="external-link">read_point_obs</a></span><span class="op">(</span>
    start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/first_validdate.html" class="external-link">first_validdate</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span>,
    end_date   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/last_validdate.html" class="external-link">last_validdate</a></span><span class="op">(</span><span class="va">fcst</span><span class="op">)</span>,
    parameter  <span class="op">=</span> <span class="va">param</span>, 
    obs_path   <span class="op">=</span> <span class="va">obs_path</span>,
    stations   <span class="op">=</span> <span class="va">stations</span>
  <span class="op">)</span>
  
  <span class="co"># If no obervations were found return NULL</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>
  
  <span class="va">fcst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/join_to_fcst.html" class="external-link">join_to_fcst</a></span><span class="op">(</span><span class="va">fcst</span>, <span class="va">obs</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="va">fcst_type</span> <span class="op">==</span> <span class="st">"det"</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/pooled_bootstrap_score.html" class="external-link">pooled_bootstrap_score</a></span><span class="op">(</span>
      <span class="va">fcst</span>, 
      <span class="va">det_verify</span>,        
      <span class="op">{</span><span class="op">{</span><span class="va">param</span><span class="op">}</span><span class="op">}</span>,
      n         <span class="op">=</span> <span class="va">n</span>,     
      pooled_by <span class="op">=</span> <span class="va">pooled_by</span>,
      min_cases <span class="op">=</span> <span class="va">min_cases</span>, 
      groupings <span class="op">=</span> <span class="va">groupings</span>
    <span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/pooled_bootstrap_score.html" class="external-link">pooled_bootstrap_score</a></span><span class="op">(</span>
      <span class="va">fcst</span>, 
      <span class="va">ens_verify</span>,        
      <span class="op">{</span><span class="op">{</span><span class="va">param</span><span class="op">}</span><span class="op">}</span>,
      n         <span class="op">=</span> <span class="va">n</span>,     
      pooled_by <span class="op">=</span> <span class="va">pooled_by</span>,
      min_cases <span class="op">=</span> <span class="va">min_cases</span>, 
      groupings <span class="op">=</span> <span class="va">groupings</span>
    <span class="op">)</span>
  <span class="op">}</span>
  
<span class="op">}</span></code></pre></div>
<p>Now we have our function we can call if for multiple parameters using <code>lapply</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T2m"</span>, <span class="st">"S10m"</span>, <span class="st">"T850"</span>, <span class="st">"T700"</span>, <span class="st">"T500"</span>, <span class="st">"Td850"</span>, <span class="st">"Td700"</span>, <span class="st">"Td500"</span><span class="op">)</span>

<span class="va">scorecard_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>
  <span class="va">parameters</span>, 
  <span class="va">scorecard_function</span>,
  start_date <span class="op">=</span> <span class="fl">2019021700</span>,
  end_date   <span class="op">=</span> <span class="fl">2019021718</span>,
  by         <span class="op">=</span> <span class="st">"6h"</span>,
  fcst_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AROME_Arctic_prod"</span>, <span class="st">"MEPS_prod"</span><span class="op">)</span>,
  fcst_type  <span class="op">=</span> <span class="st">"det"</span>,
  fcst_path  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"FCTABLE/deterministic"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>,
  obs_path   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"OBSTABLE"</span>, package <span class="op">=</span> <span class="st">"harpData"</span><span class="op">)</span>, 
  n          <span class="op">=</span> <span class="fl">100</span>, 
  pooled_by  <span class="op">=</span> <span class="st">"SID"</span>,
  min_cases  <span class="op">=</span> <span class="fl">5</span>
<span class="op">)</span></code></pre></div>
<p>The output in <code>scorecard_data</code> is a list, with one element for each parameter. Before we can plot the score card, we need to bind all of those elements into a single element using <code><a href="https://rdrr.io/pkg/harpPoint/man/bind_bootstrap_score.html" class="external-link">harpPoint::bind_bootstrap_score</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scorecard_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/harpPoint/man/bind_bootstrap_score.html" class="external-link">bind_bootstrap_score</a></span><span class="op">(</span><span class="va">scorecard_data</span><span class="op">)</span></code></pre></div>
<p>Now we can plot the score card using <code><a href="https://rdrr.io/pkg/harpVis/man/plot_scorecard.html" class="external-link">harpVis::plot_scorecard</a></code>. We need to tell the function which model we want to assess and which model to use as the reference. We also need to tell the function which scores we want to include in the score card.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/harpVis/man/plot_scorecard.html" class="external-link">plot_scorecard</a></span><span class="op">(</span>
  <span class="va">scorecard_data</span>, 
  fcst_model <span class="op">=</span> <span class="st">"AROME_Arctic_prod"</span>, 
  ref_model  <span class="op">=</span> <span class="st">"MEPS_prod"</span>, 
  scores     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rmse"</span>, <span class="st">"mae"</span>, <span class="st">"bias"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="scorecards_files/figure-html/plot_sc_run-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrew Singleton, Alex Deckmyn.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
